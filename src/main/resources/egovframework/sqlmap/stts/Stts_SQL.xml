<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="egovframework.stts.mapper.SttsMapper">
	<select id="getRis1201Q01" resultType="egovframework.stts.model.Ris1201DTO">
		   SELECT IFNULL(B.MDDL_KR_NM, "총 합") AS ROOM_NM,
		          CASE WHEN IFNULL(B.MDDL_KR_NM, "총 합") = "총 합" THEN "총 합계" ELSE IFNULL(C.IMGN_KR_NM, "소 계") END AS IMGN_NM,
		          SUM(CASE WHEN EXTRACT(MONTH FROM PRSC_DATE) = 1 THEN 1 ELSE 0 END) AS JANUARY,
		          SUM(CASE WHEN EXTRACT(MONTH FROM PRSC_DATE) = 2 THEN 1 ELSE 0 END) AS FEBRURY,
		          SUM(CASE WHEN EXTRACT(MONTH FROM PRSC_DATE) = 3 THEN 1 ELSE 0 END) AS MARCH,
		          SUM(CASE WHEN EXTRACT(MONTH FROM PRSC_DATE) = 4 THEN 1 ELSE 0 END) AS APRIL,
		          SUM(CASE WHEN EXTRACT(MONTH FROM PRSC_DATE) = 5 THEN 1 ELSE 0 END) AS MAY
		          SUM(CASE WHEN EXTRACT(MONTH FROM PRSC_DATE) = 6 THEN 1 ELSE 0 END) AS JUNE,
		          SUM(CASE WHEN EXTRACT(MONTH FROM PRSC_DATE) = 7 THEN 1 ELSE 0 END) AS JULY,
		          SUM(CASE WHEN EXTRACT(MONTH FROM PRSC_DATE) = 8 THEN 1 ELSE 0 END) AS AUGUST,
		          SUM(CASE WHEN EXTRACT(MONTH FROM PRSC_DATE) = 9 THEN 1 ELSE 0 END) AS SEPTEMBER,
		          SUM(CASE WHEN EXTRACT(MONTH FROM PRSC_DATE) = 10 THEN 1 ELSE 0 END) AS OCTOBER,
		          SUM(CASE WHEN EXTRACT(MONTH FROM PRSC_DATE) = 11 THEN 1 ELSE 0 END) AS NOVEMBER,
		          SUM(CASE WHEN EXTRACT(MONTH FROM PRSC_DATE) = 12 THEN 1 ELSE 0 END) AS DECEMBER,
		          SUM(CASE WHEN EXTRACT(MONTH FROM PRSC_DATE) BETWEEN 1 AND 12 THEN 1 ELSE 0 END) AS TOTAL
		     FROM ris1201 A
		LEFT JOIN ris0102 B
		       ON B.HSPT_ID = 'A001' AND B.LRGC_CD = "IMGN_ROOM_CD" AND A.IMGN_ROOM_CD = B.MDDL_CD
		LEFT JOIN ris0201 C
		       ON C.HSPT_ID = 'A001' AND A.IMGN_CD = C.IMGN_CD
		    WHERE A.HSPT_ID = 'A001' AND A.PRSC_DATE IS NOT NULL
	     GROUP BY B.MDDL_KR_NM, C.IMGN_KR_NM WITH ROLLUP;
	</select>
</mapper>