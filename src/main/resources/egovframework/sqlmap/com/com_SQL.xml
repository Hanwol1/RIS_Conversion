<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="egovframework.com.mapper.ComMapper">
	<!-- 사용자관리 그리드1(메뉴 1) -->
	<select id="RisUserList" resultType="egovframework.com.model.RisUserDTO">
		SELECT A.LOGIN_ID, A.LOGIN_NM, '********' as LOGIN_PWD, B.MDDL_KR_NM, A.START_DATE, A.END_DATE, A.ERROR_CNT
		FROM risuser A
		LEFT JOIN ris0102 B
		ON A.HSPT_ID = B.HSPT_ID 
		AND A.USER_GRADE = B.MDDL_CD
		WHERE B.LRGC_CD = "GRADE"
		ORDER BY LOGIN_ID
	</select>
	
	<!-- 사용자관리 권한 변경(메뉴 1) -->
	<select id="selectMddlcd" parameterType="string" resultType="string">
		SELECT DISTINCT MDDL_CD
		FROM	ris0102
		WHERE MDDL_KR_NM = #{mddlKrNm}
			AND LRGC_CD = 'GRADE'
	</select>
	
	<!-- 사용자관리 수정(메뉴 1) -->
	<update id="updateData" parameterType="egovframework.com.model.RisUserDTO">
		UPDATE risuser
		SET
			USER_GRADE = #{userGrade},
			START_DATE = #{startDate},
			END_DATE = #{endDate}
		WHERE
			HSPT_ID = 'A001' AND LOGIN_ID = #{loginId}
	</update>
	
	<!-- 사용자관리 입력(메뉴 1) -->
	<insert id="addUserData" parameterType="egovframework.com.model.RisUserDTO">
		INSERT INTO risuser (
			HSPT_ID, LOGIN_ID, LOGIN_NM, LOGIN_PWD, USER_GRADE, START_DATE, END_DATE, ERROR_CNT
		)
		VALUES (
			"A001", #{loginId}, #{loginNm}, #{loginPwd}, #{userGrade}, #{startDate}, #{endDate}, 0
		)
	</insert>
	
	<!-- 사용자관리 비밀번호 초기화(메뉴 1) -->
	<update id="pwReset" parameterType="egovframework.com.model.RisUserDTO">
		UPDATE risuser
		SET
			LOGIN_PWD = 1
		WHERE
			LOGIN_ID = #{loginId}
	</update>
	
	
	<!-- 프로그램 정보 관리 그리드(메뉴 2) -->
	<select id="RisPgrmList" resultType="egovframework.com.model.RisPgrmDTO">
		SELECT A.HSPT_ID, B.SYSTEM_NAME, A.PGRM_ID, A.PGRM_NAME, A.PGRM_URL,
		CASE WHEN A.PGRM_TYPE = 'W' THEN '등록' WHEN A.PGRM_TYPE = 'M' THEN '메뉴' WHEN A.PGRM_TYPE = 'Q' THEN '조회' END AS PGRM_TYPE,
		CASE WHEN A.PGRM_INFO = 'M' THEN '메인화면' WHEN A.PGRM_INFO = 'P' THEN '팝업화면' WHEN A.PGRM_INFO = 'Z' THEN '메뉴헤더' END AS PGRM_INFO, 
		A.USE_YN, A.END_YN
		FROM rispgrm A
		LEFT JOIN rissytm B
		ON A.HSPT_ID = B.HSPT_ID
		AND A.SYSTEM_ID = B.SYSTEM_ID
		WHERE A.HSPT_ID = #{hsptId}
	</select>
	
	<!-- 사용자관리 권한 변경(메뉴 2) -->
	<select id="selectSystemid" parameterType="string" resultType="string">
		SELECT SYSTEM_ID
		FROM rissytm
		WHERE SYSTEM_NAME = #{systemName}
	</select>
	
	<!--  프로그램 정보 관리 수정(메뉴 2)
	<update id="updatePgrmData" parameterType="egovframework.com.model.RisPgrmDTO">

	</update>
	 -->
	<!-- 프로그램 정보 관리 입력(메뉴 2) -->
	<insert id="addPgrmData" parameterType="egovframework.com.model.RisPgrmDTO">
		INSERT INTO rispgrm (
			SYSTEM_ID, PGRM_ID, PGRM_NAME, PGRM_URL, PGRM_TYPE, PGRM_INFO, USE_YN, END_YN, HSPT_ID
		)
		VALUES (
			#{systemId}, #{pgrmId}, #{pgrmName}, #{pgrmUrl}, #{pgrmType}, #{pgrmInfo}, #{useYn}, #{endYn}, #{hsptId}
		); 
	</insert>
	
	<!-- 메뉴 정보 관리 그리드1(메뉴 3) -->
	<select id="RisGrupList" resultType="egovframework.com.model.RisGrupDTO">
		SELECT DISTINCT MENU_GROUP_ID, MENU_GROUP_NAME, OTPT_SQNC, USE_YN
		FROM risgrup
		ORDER BY OTPT_SQNC ASC
	</select>
		
	<!-- 메뉴 정보 관리 그리드2(메뉴 3) -->
	<select id="RisGrmuList" parameterType="String" resultType="egovframework.com.model.RisGrmuDTO">
		SELECT A.MENU_ID, A.PGRM_ID, B.PGRM_NAME, A.MENU_NAME, A.MENU_NAME_SUB, A.UPPER_MENU_ID, A.MENU_LEVEL, A.OTPT_SQNC, A.USE_YN
		FROM risgrmu A
		LEFT JOIN rispgrm B
		ON A.PGRM_ID = B.PGRM_ID
		WHERE MENU_GROUP_ID = #{type}
	</select>
	
	<!-- risMenuE00 그리드1 저장(메뉴정보 관리)
	<insert id="addList1Data" parameterType="egovframework.com.model.RisGrupDTO">
		INSERT INTO risgrup (
			MENU_GROUP_ID, MENU_GROUP_NAME, OTPT_SQNC, USE_YN
		)
		VALUES (
			#{menuGroupId}, #{menuGroupName}, #{otptSqnc}, #{useYn}
		)
	</insert>
	 -->
		
		
	<!-- 사용자별 메뉴관리 그리드1(메뉴 4) -->
	<select id="RisUserMenuList" resultType="egovframework.com.model.RisUserDTO">
		SELECT DISTINCT A.LOGIN_ID, A.LOGIN_NM, B.MDDL_KR_NM, A.HSPT_ID
		FROM risuser A
		LEFT JOIN ris0102 B
		ON A.HSPT_ID = B.HSPT_ID 
		AND A.USER_GRADE = B.MDDL_CD
		WHERE B.LRGC_CD = "GRADE"
		ORDER BY LOGIN_ID
	</select>
	
	<!-- 사용자별 메뉴관리 그리드2(메뉴 4) -->
	<select id="RisUserMenuList2" parameterType="String" resultType="egovframework.com.model.RisUrmnDTO">
		SELECT A.MENU_GROUP_ID, B.MENU_GROUP_NAME, A.MENU_ID, A.MENU_NAME, 
			CASE WHEN A.MENU_GRADE = 'W' THEN '등록' WHEN A.MENU_GRADE = 'V' THEN '조회' END AS MENU_GRADE
		, A.USE_YN, A.OTPT_SQNC
		FROM risurmn A
		LEFT JOIN risgrup B
		ON A.MENU_GROUP_ID = B.MENU_GROUP_ID 
		AND A.HSPT_ID = B.HSPT_ID
		WHERE A.LOGIN_ID = #{type}
		AND A.HSPT_ID = #{type2}
	</select>
		
	<!-- 사용자별 메뉴관리 팝업(메뉴 4) -->
	<select id="popupUrmnList" resultType="egovframework.com.model.RisUrmnDTO">
		SELECT DISTINCT MENU_GROUP_ID, MENU_NAME
		FROM risurmn
	</select>
		
		
		
	<!-- 프로그램 기능 권한 그리드(메뉴 5) -->
	<select id="RisBtnList" resultType="egovframework.com.model.RisBtnDTO">
		SELECT A.DATA_GUBUN, A.USER_GRADE, B.PGRM_NAME, A.PGRM_BTN, A.USE_YN
		FROM risbtn A
		LEFT JOIN rispgrm B
		ON A.HSPT_ID = B.HSPT_ID 
		AND A.PGRM_ID = B.PGRM_ID
	</select>
	
</mapper>